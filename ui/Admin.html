<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
  </script>
  <title>AdminFlightPage</title>
  <!-- custom css: -->
  <link rel="stylesheet" href="css/styles.css">


</head>

<body>
  <div>
    <h1>Schedule A New Flight</h1>
    <form id="addFlight">
      <label for="origin">Origin City: </label><br />
      <input type="text" name="origin" id="originCity" required /><br />

      <label for="destination">Destination: </label><br />
      <input type="text" name="destination" id="destination" required /><br />

      <label for="start_time">Start Date: </label><br />
      <input type="date" name="start_time" id="start_time" required /><br />

      <label for="end_time">End Date: </label><br />
      <input type="date" name="end_time" id="end_time" required /><br />

      <button type="submit">Submit</button><br /><br />
      <button type="reset">Reset</button>
    </form>
  </div>

  <div>
    <h1>Cancel A Flight</h1>
    <form id="cancelFlight">
      <label for="flightNumber">Flight Number: </label><br />
      <input type="number" id="flightNumber" required /><br /><br />
      <button type="submit">Cancel Flight</button><br /><br />
      <button type="reset">Reset</button>
    </form>
  </div>

  <div>
    <h1>Active Flight(s)</h1>
    <table>
      <thead>
        <tr>
          <th>Ticket Number |</th>
          <th>User Name |</th>
          <th>Flight Number |</th>
          <th>Checked In?</th>
        </tr>
      </thead>
      <tbody id="activeTicketsTable"></tbody>
    </table>
    <form id="removeTicket">
      <br><label for="ticketNumber" text-align: center>If you would like to remove a ticket enter the ticket number
        below:</label><br>
      <input type="number" name="ticketNumber" id="ticketNumber" />
      <button type="submit">Submit</button>
    </form>

  </div>

  <script>
    const form = document.getElementById("addFlight");

    form.addEventListener("submit", function (event) {
      event.preventDefault();
      submitForm(
        originCity.value,
        destination.value,
        start_time.value,
        end_time.value,
      );
    });

    async function submitForm(
      originCityValue,
      destinationValue,
      sTimeValue,
      eTimeValue,
    ) {
      let formObject = {
        origin: originCityValue,
        destination: destinationValue,
        begin: sTimeValue,
        end: eTimeValue,
      };
      console.log(formObject);

      let response = await fetch("http://localhost:8080/Project-1/flights", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Method": "addFlight"
        },
        body: JSON.stringify(formObject),
      });
    }

    async function getActivePassengers() {
      let resp = await fetch(
        "http://localhost:8080/Project-1/active-passengers"
      );
      let json = await resp.jason();
      let table = document.getElementById("activePassengersTable");

      for (let element of json) {
        let tr = table.insertRow(-1);
        for (let key in elements) {
          let cell = tr.insertCell(-1);
          cell.innerHTML = element[key];
        }
      }
    }
    async function getAllFlights() {
      let resp = await fetch(
        "http://localhost:8080/Project-1/active-Flights"
      );
      let json = await resp.jason();
      let table = document.getElementById("activeFlightsTable");
      for (let element of json) {
        let tr = table.insertRow(-1);
        for (let key in elements) {
          let cell = tr.insertCell(-1);
          cell.innerHTML = element[key];
        }
      }
    }

    const cancelForm = document.getElementById("cancelFlight");

    cancelForm.addEventListener("submit", function (event) {
      event.preventDefault();
      cancelForm2(

        flightNumber.value
      );
    });


    async function cancelForm2() {

      let formObject = {
        flightNumber: flightNumber.value,
      };
      console.log("cancel form reached");
      let resp = await fetch("http://localhost:8080/Project-1/flights", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Method": "cancelFlight"
        },
        body: JSON.stringify(formObject),
      });
    }

    (async function getTickets() {
      let response = await fetch(
        "http://localhost:8080/Project-1/tickets"); //1 parameter assumes this is a get request
      let json = await response.json();
      await populateTable(json);
      Promise.resolve();
    })();

    function populateTable(json) {
      let table = document.getElementById("activeTicketsTable");

      for (let element of json) {
        let tr = table.insertRow(-1);
        for (let key in element) {
          let cell = tr.insertCell(-1);
          cell.innerHTML = element[key];
        }
      }
    }
    const RemoveTicketForm = document.getElementById("removeTicket")

    RemoveTicketForm.addEventListener("submit", function (event) {
      event.preventDefault();
      console.log(ticketNumber.value);
      removeTicketResponse(ticketNumber.value);
    });

    async function removeTicketResponse(ticketNumberValue) {
      let formObject = {
        ticketNumber: ticketNumberValue
      }

      console.log(formObject);

      let response = await fetch("http://localhost:8080/Project-1/tickets", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Method": "removeTicket"
        },
        body: JSON.stringify(formObject)
      });
    }
  </script>
</body>
</html>